<!DOCTYPE html>
<html>
<head>
    <title>채팅 테스트</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <style>
        #messages {
            height: 400px;
            overflow-y: auto;
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 10px;
        }
        .message {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div>
        <input type="text" id="token" placeholder="JWT 토큰 입력" style="width: 300px;">
        <button onclick="connect()">연결</button>
        <button onclick="disconnect()">연결 해제</button>
    </div>
    <div>
        <input type="text" id="roomId" placeholder="채팅방 ID">
        <button onclick="joinRoom()">채팅방 입장</button>
        <button onclick="leaveRoom()">채팅방 퇴장</button>
    </div>
    <div id="messages"></div>
    <div>
        <input type="text" id="message" placeholder="메시지 입력">
        <button onclick="sendMessage()">전송</button>
    </div>

    <script>
        let socket;
        let currentRoom = null;

        function connect() {
            const token = document.getElementById('token').value;
            socket = io('http://localhost:3000', {
                auth: { token }
            });

            socket.on('connect', () => {
                appendMessage('시스템', '서버에 연결되었습니다.');
            });

            socket.on('disconnect', () => {
                appendMessage('시스템', '서버와 연결이 끊어졌습니다.');
            });

            socket.on('newMessage', (message) => {
                appendMessage(message.sender.name, message.content);
            });

            socket.on('userJoined', (data) => {
                appendMessage('시스템', `${data.userName}님이 입장했습니다.`);
            });

            socket.on('userLeft', (data) => {
                appendMessage('시스템', `${data.userName}님이 퇴장했습니다.`);
            });

            socket.on('error', (error) => {
                appendMessage('시스템', `에러: ${error.message}`);
            });
        }

        function disconnect() {
            if (socket) {
                if (currentRoom) {
                    leaveRoom();
                }
                socket.disconnect();
                appendMessage('시스템', '연결이 해제되었습니다.');
            }
        }

        function joinRoom() {
            const roomId = document.getElementById('roomId').value;
            if (socket && roomId) {
                socket.emit('joinRoom', roomId);
                currentRoom = roomId;
                appendMessage('시스템', `채팅방 ${roomId}에 입장했습니다.`);
            }
        }

        function leaveRoom() {
            if (socket && currentRoom) {
                socket.emit('leaveRoom', currentRoom);
                appendMessage('시스템', `채팅방 ${currentRoom}에서 퇴장했습니다.`);
                currentRoom = null;
            }
        }

        function sendMessage() {
            const messageInput = document.getElementById('message');
            const content = messageInput.value;
            if (socket && currentRoom && content) {
                socket.emit('sendMessage', {
                    content,
                    chatRoomId: currentRoom
                });
                messageInput.value = '';
            }
        }

        function appendMessage(sender, content) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            messageDiv.textContent = `${sender}: ${content}`;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // Enter 키로 메시지 전송
        document.getElementById('message').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html> 